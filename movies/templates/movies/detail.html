<h1>{{ movie.title }}</h1>
<img src="https://image.tmdb.org/t/p/w300{{ movie.poster_path }}" alt="{{ movie.title }}">
<p>{{ movie.overview }}</p>

<h2>Reviews</h2>
{% for review in reviews %}
  <div>
    <strong>{{ review.user.username }}</strong> - {{ review.rating }}‚≠ê
    <p>{{ review.comment }}</p>

    {% if review.user == request.user %}
      <a href="{% url 'edit_review' review.id %}">Edit</a> |
      <a href="{% url 'delete_review' review.id %}">Delete</a>
    {% endif %}
  </div>
{% empty %}
  <p>No reviews yet.</p>
{% endfor %}

  <!-- Watchlist -->
       {% if user.is_authenticated %}
  {% if movie in user.watchlist.all|map:"movie" %}
    <a href="{% url 'remove_from_watchlist' movie.tmdb_id %}" class="btn btn-sm btn-danger">Remove from Watchlist</a>
    <a href="{% url 'toggle_watched' movie.tmdb_id %}" class="btn btn-sm btn-secondary">
      {% if movie.watchlist_entries.get(user=request.user).watched %}
        Mark as Unwatched
      {% else %}
        Mark as Watched
      {% endif %}
    </a>
  {% else %}
    <a href="{% url 'add_to_watchlist' movie.tmdb_id %}" class="btn btn-sm btn-primary">Add to Watchlist</a>
  {% endif %}
{% endif %}

<h2>Leave a Review</h2>
<form method="POST" action="{% url 'add_review' movie.id %}">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Submit</button>
</form>