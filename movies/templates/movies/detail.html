{% extends "base.html" %}
{% block content %}
<section class="movie-detail-section">
  
  <!-- Movie Title -->
  <h1 class="movie-title">{{ movie.title }}</h1>
  
  <!-- Poster -->
  {% if movie.poster_path %}
    <img 
      src="https://image.tmdb.org/t/p/w300{{ movie.poster_path }}" 
      alt="{{ movie.title }}" 
      class="movie-poster">
  {% endif %}
  
  <!-- Overview -->
  <p class="movie-overview">{{ movie.overview }}</p>
  
  <!-- Watchlist / Watched Buttons -->
  {% if user.is_authenticated %}
    <div class="watchlist-buttons">
      {% if movie.tmdb_id in watchlist_movies %}
        <a href="{% url 'remove_from_watchlist_tmdb' movie.tmdb_id %}" class="btn btn-sm btn-danger">Remove from Watchlist</a>
      {% else %}
        <a href="{% url 'add_to_watchlist_tmdb' movie.tmdb_id %}" class="btn btn-sm btn-primary">Add to Watchlist</a>
      {% endif %}
    </div>
  {% endif %}
  
  <!-- Reviews Section -->
  <h2 class="reviews-heading">Reviews</h2>
  <ul class="reviews-list">
    {% for review in reviews %}
      <li class="review-item">
        <div>
          <strong>{{ review.user.username }}</strong>: {{ review.comment }}<br>
          {% for i in "12345" %}
            {% if forloop.counter <= review.rating %} ⭐ {% else %} ☆ {% endif %}
          {% endfor %}
        </div>
        {% if user.is_authenticated and review.user == user %}
          <div class="review-actions">
            <a href="{% url 'edit_review' review.id %}" title="Edit"><i class="fa-solid fa-pen-to-square"></i></a>
            <a href="{% url 'delete_review' review.id %}" title="Delete" onclick="return confirm('Are you sure?')"><i class="fa-solid fa-trash"></i></a>
          </div>
        {% endif %}
      </li>
    {% empty %}
      <li class="no-reviews">No reviews yet.</li>
    {% endfor %}
  </ul>
  
  <!-- Add Review Form -->
{% if user.is_authenticated %}
  <form method="POST" action="{% url 'add_review' movie.id %}" class="edit-review-form">
    {% csrf_token %}

    {{ form.non_field_errors }}

    <!-- Rating -->
    <div class="rating-group">
      <label class="rating-label">Rating:</label>
      <div class="star-rating">
        {% for star_value in "54321" %}
          <input type="radio" name="rating" id="star{{ star_value }}" value="{{ star_value }}" {% if form.rating.value == star_value %}checked{% endif %}>
          <label for="star{{ star_value }}">&#9733;</label>
        {% endfor %}
      </div>
      {{ form.rating.errors }}
    </div>

    <!-- Comment -->
    <div class="comment-group">
      {{ form.comment.errors }}
      <textarea name="comment" placeholder="Write a review..." class="review-input" required rows="3">{{ form.comment.value }}</textarea>
    </div>

    <button type="submit" class="auth-btn">Submit Review</button>
  </form>
{% endif %}
</section>
{% endblock %}
