{% extends "base.html" %}
{% block content %}
<section class="watchlist-section">
  <h2 class="page-title">My Watchlist</h2>

  {% if entries %}
    <div class="watchlist-grid">
      {% for entry in entries %}
        <div class="movie-card">

          <!-- Poster -->
          {% if entry.movie.poster %}
            <img src="{{ entry.movie.poster.url }}" alt="{{ entry.movie.title }} poster" class="movie-poster" loading="lazy"/>
          {% elif entry.movie.poster_path %}
            <img src="https://image.tmdb.org/t/p/w300{{ entry.movie.poster_path }}" alt="{{ entry.movie.title }} poster" class="movie-poster" loading="lazy"/>
          {% else %}
            <div class="no-poster">No Poster</div>
          {% endif %}

          <!-- Info -->
          <div class="movie-info">
            <div>
              <h3 class="movie-title">{{ entry.movie.title }}</h3>
              {% if entry.movie.release_year %}
                <p class="movie-year">({{ entry.movie.release_year }})</p>
              {% elif entry.movie.release_date %}
                <p class="movie-year">({{ entry.movie.release_date|slice:":4" }})</p>
              {% endif %}

              <p class="watched-status">
                Watched: <span>{{ entry.watched|yesno:"✅,❌" }}</span>
              </p>
            </div>

            <!-- Buttons -->
            <div class="movie-buttons">
              {% if entry.movie.tmdb_id %}
                <a href="{% url 'movie_detail' entry.movie.tmdb_id %}" class="btn-review">View & Review</a>
                <div class="btn-group">
                  <a href="{% url 'toggle_watched_tmdb' entry.movie.tmdb_id %}" class="btn-accent">Toggle Watched</a>
                  <a href="{% url 'remove_from_watchlist_tmdb' entry.movie.tmdb_id %}" class="btn-remove">Remove</a>
                </div>
              {% else %}
                <a href="{% url 'movie_detail' entry.movie.id %}" class="btn-review">View & Review</a>
                <div class="btn-group">
                  <a href="{% url 'toggle_watched_local' entry.movie.id %}" class="btn-accent">Toggle Watched</a>
                  <a href="{% url 'remove_from_watchlist_local' entry.movie.id %}?next={{ request.path }}" class="btn-remove">Remove</a>
                </div>
              {% endif %}
            </div>

          </div> <!-- movie-info -->
        </div> <!-- movie-card -->
      {% endfor %}
    </div> <!-- watchlist-grid -->
  {% else %}
    <div class="empty-watchlist">
      <p>Your watchlist is empty.</p>
    </div>
  {% endif %}
</section>
{% endblock %}
